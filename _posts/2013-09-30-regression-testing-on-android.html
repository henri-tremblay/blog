---
layout: post
title: Regression testing on Android
date: '2013-09-30T01:14:00.000-07:00'
author: Henri Tremblay
tags:
- What I learned today
modified_time: '2013-09-30T01:14:02.035-07:00'
blogger_id: tag:blogger.com,1999:blog-8282654404214414992.post-5720471413506822209
blogger_orig_url: http://blog.tremblay.pro/2013/09/regression-testing-on-android.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">Having <a href="http://objenesis.org/" target="_blank">Objenesis</a>&nbsp;now working on Android is forcing me to make sure it keeps working. This is a call for automated regression tests.<br /><br />The original idea was to test on <a href="http://www.cloudbees.com/#slide-2" target="_blank">Cloudbees</a>&nbsp;on all the supported API levels (8 to 18 as of now). Luckily there is an SDK installed in their instances. And two nice <span id="goog_1550451776"></span><a href="http://blog.cloudbees.com/2012/09/continuous-integration-for-mobile-apps.html" target="_blank">blog</a> <span id="goog_1550451777"></span><a href="http://blog.cloudbees.com/2012/09/continuous-integration-for-mobile-apps_28.html" target="_blank">posts</a> explaining how to configure it.<br /><br />However, I ended up using a local VM because I had some stability issues. Random parts of the build were<br /><br />Everything starts with the <a href="https://wiki.jenkins-ci.org/display/JENKINS/Android+Emulator+Plugin" target="_blank">Android Emulator Plugin</a>. We also need the <a href="https://wiki.jenkins-ci.org/display/JENKINS/EnvInject+Plugin" target="_blank">EnvInject Plugin</a> on Cloudbees.<br /><br />Then, follow these steps:<br /><br /><ul style="text-align: left;"><li>Create a multi-configuration project</li><li>Add three user-defined axis</li><ul><li>&nbsp;os (<span style="font-family: Courier New, Courier, monospace;">android-8 android-10 android-11 android-12 android-13&nbsp;android-14 android-15 android-16 android-17&nbsp;android-18)</span></li><li>resolution (<span style="font-family: Courier New, Courier, monospace;">HVGA WXGA</span>)</li><li>abi (<span style="font-family: Courier New, Courier, monospace;">armeabi armeabi-v7a</span>)</li></ul></ul><div>Now it gets funny because you need to find a combination filter mixing these three axis to create valid configurations.</div><div style="text-align: left;"><ul style="text-align: left;"><li>Combination filter:&nbsp;(<span style="font-family: Courier New, Courier, monospace;">os==~/android-1[1,2,3]/).implies(resolution=="WXGA") &amp;&amp; (!(os==~/android-1[1,2,3]/)).implies(resolution=="HVGA") &amp;&amp; (!(os==~/android-1[4,5,6,7,8]/)).implies(abi=="armeabi") &amp;&amp; (os==~/android-1[4,5,6,7,8]/).implies(abi=="armeabi-v7a"</span>)</li></ul>From there you might ask why I'm using <span style="font-family: Courier New, Courier, monospace;">android-18</span> instead of <span style="font-family: Courier New, Courier, monospace;">4.3</span> as the target id. That's because it doesn't work. All other versions can be named using the Android version but not 4.3. It looks like a bug of the SDK.</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Run each configuration sequentially if you're in local. You won't need it on Cloudbees since it can parallelize the build on many instances.</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Then, you now to configure the emulator.</div><div style="text-align: left;"><ul style="text-align: left;"><li>Check "Run an emulator during build"</li><li>Select "Run emulator with properties"</li><ul><li>Android OS version: ${os}</li><li>Screen density: mdpi</li><li>Screen resolution: ${resolution}</li><li>Device locale: en_US</li><li>Target ABI: ${abi}</li></ul><li>Check "Reset emulator state at start-up"</li><li>Check "Use emulator snapshots"</li><li>Emulator options:&nbsp;-no-audio -gpu off</li></ul><div>Finally, just add your Android build using the emulator. And hopefully, everything should be alright.</div><div><br /></div></div></div>